import{r as t,c as i,h as e,H as n}from"./p-66ea3b4c.js";import{I as o}from"./p-64bdd77e.js";const s=class{constructor(e){t(this,e),this.selectionChangedEvent=i(this,"selectionChanged",7),this.selectionErrorEvent=i(this,"selectionError",7),this.maxSelectionSize=1,this.enabled=!0,this.elementsWithTooltips=[],this.elementDivs=[]}getRegions(){var t,i;return null!==(i=null===(t=this.imageWithRegionsDefinition)||void 0===t?void 0:t.Regions)&&void 0!==i?i:[]}itemClicked(t){this.enabled&&this.getRegions().filter((i=>i.id==t))[0].status==o.AVAILABLE&&(this.selectedIds.includes(t)?(this.selectedIds=this.selectedIds.filter((i=>i!=t)),this.selectionChangedEvent.emit({})):1==this.maxSelectionSize?(this.selectedIds=[t],this.selectionChangedEvent.emit({})):0==this.maxSelectionSize||this.maxSelectionSize>this.selectedIds.length?(this.selectedIds=this.selectedIds.concat(t),this.selectionChangedEvent.emit({})):(this.errorCode=s.ERROR_SELECTION_FULL,this.selectionErrorEvent.emit({})))}componentDidRender(){$(this.elementsWithTooltips).tooltip()}render(){return this.imageWithRegionsDefinition?this.renderExistingDefinition():this.renderNonExistingDefinition()}renderNonExistingDefinition(){return e("div",null,"Image definition not set")}renderExistingDefinition(){var t,i,o,s,r,l,a,h,u,c;return this.elementsWithTooltips=[],this.elementDivs=[],e(n,null,e("div",{class:null!==(o="K2BT_LocationInBlueprintSelectorContainer "+(null===(i=null===(t=this.imageWithRegionsDefinition)||void 0===t?void 0:t.Frame)||void 0===i?void 0:i.class))&&void 0!==o?o:"",style:{height:null===(r=null===(s=this.imageWithRegionsDefinition)||void 0===s?void 0:s.Frame)||void 0===r?void 0:r.height,width:null===(a=null===(l=this.imageWithRegionsDefinition)||void 0===l?void 0:l.Frame)||void 0===a?void 0:a.width,backgroundImage:""!=(null!==(c=null===(u=null===(h=this.imageWithRegionsDefinition)||void 0===h?void 0:h.Frame)||void 0===u?void 0:u.backgroundImageURL)&&void 0!==c?c:"")?"url("+this.imageWithRegionsDefinition.Frame.backgroundImageURL+")":null}},this.getRegions().map((t=>this.renderRegion(t)))))}renderRegion(t){var i=this.getBestImageForItemStatus(t),n={backgroundImage:"",height:t.height,width:t.width,top:t.top,left:t.left};return e("div",{class:"K2BT_LocationInBlueprintSelectorItem"+(this.selectedIds.map((t=>t.toString().trim())).includes(t.id.toString().trim())?" K2BT_LocationInBlueprintSelectorItemSelected":"")+(t.status!=o.UNAVAILABLE&&this.enabled?"":" K2BT_LocationInBlueprintSelectorItemUnavailable")+(""!=t.class?" "+t.class:""),ref:i=>this.elementDivs.push({id:t.id,element:i}),style:n},this.getMapForItem(t),this.getImage(t,i),e("span",{class:"K2BT_LocationInBlueprintSelectorItemName"},t.name))}getBestImageForItemStatus(t){return this.selectedIds.map((t=>t.toString().trim())).includes(t.id.toString().trim())&&""!=t.selectedImageURL?t.selectedImageURL:this.enabled&&t.status!=o.UNAVAILABLE||""==t.unavailableImageURL?t.availableImageURL:t.unavailableImageURL}getImage(t,i){return e("img",{ref:i=>{""==t.selectableRegionCoordinates&&this.elementsWithTooltips.push(i)},title:""==t.selectableRegionCoordinates?this.getTooltipLines(t):"",src:i,style:{height:"100%",width:"100%",cursor:""==t.selectableRegionCoordinates?"pointer":null},usemap:""!=t.selectableRegionCoordinates?"#K2BT_Image"+t.id:null,onClick:()=>{""==t.selectableRegionCoordinates&&this.itemClicked(t.id)}})}getTooltipLines(t){return null==t.tooltipLines||0==t.tooltipLines.length?null:t.tooltipLines.join("\n")}getMapForItem(t){if(""!=t.selectableRegionCoordinates)return e("map",{name:"K2BT_Image"+t.id},e("area",{shape:"poly",coords:t.selectableRegionCoordinates,onClick:()=>this.itemClicked(t.id),href:"#",title:this.getTooltipLines(t),ref:t=>this.elementsWithTooltips.push(t)}),e("area",{shape:"poly",coords:"0,0,"+t.width+",0,"+t.width+","+t.height+",0,"+t.height,onClick:i=>this.clickBelow(i,t.id),onMouseOver:i=>this.bringElementBelowToForeground(i,t.id)}))}bringElementBelowToForeground(t,i){var e=t||window.event,n=this.elementDivs.filter((t=>t.id==i))[0].element;n.style.pointerEvents="none";var o=document.elementFromPoint(e.clientX,e.clientY),s=this.elementDivs.filter((t=>t.element.contains(o)));s.length>0&&(console.log("hovering: "+s[0].id),this.elementDivs.forEach((t=>t.element.style.zIndex="initial")),s.forEach((t=>t.element.style.zIndex="1"))),n.style.pointerEvents="auto"}clickBelow(t,i){var e=t||window.event,n=this.elementDivs.filter((t=>t.id==i))[0].element;n.style.pointerEvents="none";var o=document.elementFromPoint(e.clientX,e.clientY),s=this.elementDivs.filter((t=>t.element.contains(o)));s.length>0&&this.itemClicked(s[0].id),n.style.pointerEvents="auto"}};s.ERROR_SELECTION_FULL="SELECTION_FULL",s.style=":host{display:block}.K2BT_LocationInBlueprintSelectorContainer{position:relative;background-repeat:no-repeat;background-size:100% 100%}.K2BT_LocationInBlueprintSelectorItem{position:absolute;background-repeat:no-repeat;background-size:100% 100%}.K2BT_LocationInBlueprintSelectorItemName{display:none}.K2BT_LocationInBlueprintSelectorContainer .tooltip-inner{white-space:pre-wrap}.K2BT_LocationInBlueprintSelectorItemUnavailable{cursor:initial;pointer-events:none}";export{s as k2bt_image_region_selector}